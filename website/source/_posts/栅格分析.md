---
title: 栅格分析
mathjax: true
cover: https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221026201327218.png
categories: GIS
---
## 距离制图

### 概念

源：距离分析中的**目标或者目的地**，可以是矢量或栅格（运算中矢量会自动转为栅格），不同源之间属性必须不同。

成本：**到达目标、目的地的花费**（金钱、时间、喜好）成本的数据的制作一般基于重分类功能。多个成本因素要指定统一的成本体系，对单个成本按其大小分类，每一类成本赋予成本量值：**成本高的量值小，成本低的量值大**。最终依据百分比加权求和，得到多个单成本因素综合影响的成本栅格数据。

成本距离加权数据：也称成本累计数据，记录**每个栅格到距离最近**、成本最低的源的**最少累加成本**。

距离方向数据：表示从每一个单元出发，沿着**最低成本路径到达最近源的路线方向**。在成本距离方向数据中，像元值为0-360表示方向角度（保留 0 以用于源像元），并且还会被分类为**1-8类表示八个不同方向**

<img src="https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221026194845063.png" alt="image-20221026194845063" style="zoom:33%;" />

分配数据：分配数据记录每一单元点隶属的最近源信息，单元值就是其最近源的值。

距离分析函数：在ArcGis Pro中旧版本的分析工具被合并（且被增强）到了以下工具中。

- 【距离分配】
  - 【成本分配】
  - 【欧式分配】
  - 【路径距离分配】
- 【距离累积】
  - 【成本回溯连接】
  - 【成本距离】
  - 【欧式反向】
  - 【欧式方向】
  - 【欧式距离】
  - 【路径距离】
- 【最佳路径为栅格】
  - 【成本路径】
- 【最佳路径为线】
  - 【成本路径折线】
- 【最佳区域连接】
  - 【成本连通性】
- 【廊道分析】

### 距离累计

使用【距离累计】工具输入直线距离累计栅格、源方向栅格、源位置栅格（分配）

![image-20221026201403354](https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221026201403354.png)![image-20221026201335805](https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221026201335805.png)

![image-20221026201327218](https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221026201327218.png)

### 成本累计

通过加入重分类后的土地利用栅格作为成本栅格，输出最终的成本累计

![image-20221026203349916](https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221026203349916.png)

### 最短路径

在生成成本累计栅格后，可根据该成本累计栅格通过加入目标数据，生成该目标到成本栅格中各源的最近路径

![image-20221026212918962](https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221026212918962.png)

## 密度制图

> 密度制图是通过离散采样点进行表面内插的过程。主要用于生成连续表面。主要分为核函数密度制图和简单密度制图

在ArcgisPro中，用【空间分析工具】-【密度分析】工具进行相关分析。核函数密度制图落入同一区域的各个要素具有不同的权重值。而简单密度制图中各要素具有相同的权重。从结果上看，核函数制图结果分布较为平滑。

## 栅格插值

> 通过离散的采样点的数值来推算其他区域的值，最终在一定范围内生成连续表面

选择合适的插值方法至关重要，以下提供ArcgisPro关于选择插值的方法的分类树。[Geostatistical Analyst 中提供的插值方法分类树—ArcGIS Pro | 文档](https://pro.arcgis.com/zh-cn/pro-app/latest/help/analysis/geostatistical-analyst/classification-trees-of-the-interpolation-methods-offered-in-geostatistical-analyst.htm)

> TODO:根据分类表将各个插值方法的特性总结到表格中

> 注意：在Arcgis Pro中，初步生成的插值面的范围常常不是想要的范围（例如生成结果完全依据要素点的显示范围，而我们希望他能填充一定的不规则边界shp）。
>
> <img src="../../../../../AppData/Roaming/Typora/typora-user-images/image-20221027154024893.png" alt="image-20221027154024893" style="zoom: 25%;" />
>
> 应按如下进行操作

右键生成的插值图层-点击【导出图层】-【转栅格】将会打开【GA图层转栅格】工具，此工具的主要用途是将地统计图层导出为多种输出类型

![image-20221027154113021](https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027154113021.png)

可设置插值类型、输出栅格大小。

<img src="https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027154302785.png" alt="image-20221027154302785" style="zoom:25%;" />

在该工具的【环境】中，设置正确的【像元大小】、【输出坐标系】、【处理范围】，并且**设置【掩膜】**要素，最终导出的栅格即为掩膜的区域。

<img src="https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027154520161.png" alt="image-20221027154520161" style="zoom:25%;" />

<img src="https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027154508779.png" alt="image-20221027154508779" style="zoom:25%;" />

## 表面分析

> 表面分析主要通过生成新数据集，如等值线、坡度、坡向、山体阴影等派生数据，反应原始数据中暗含的空间特征和空间格局。

### 因子分析方法

> 按照提取地形因子差分计算的阶数，可将地形因子分为一阶地形因子、二阶地形因子和高阶地形因子。如下：

<img src="https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027163912959.png" alt="image-20221027163912959" style="zoom: 50%;" /><img src="https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027163928264.png" alt="image-20221027163928264" style="zoom: 50%;" />

在ArcgisPro中，地形因子被整合到了【表面分析】-【表面参数】中

在【表面参数】中支持以下地形因子的计算

<img src="https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027164122951.png" alt="image-20221027164122951" style="zoom:50%;" />

坡度、坡向不再赘述。

曲率：曲率是对地形表面一点扭曲变换程度的定量化度量因子，在垂直和水平两个方向上分别称为剖面曲率和平面曲率。前者主要用以描述在某点沿最大坡降（最陡的一边）地面高程的变化率，后者描述水平方向上的弯曲变化情况。**曲率为正说明该像元的表面向上凸。 曲率为负说明该像元的表面开口朝上凹入。 值为 0 说明表面是平的**。简而言之，曲率描述了地表的凹凸起伏的复杂程度。

## 统计分析

### 像元统计

使用多个栅格数据叠合分析，以每个栅格数据中的像元为单位进行相应的统计操作，最终统计为新栅格。

<img src="https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027165140474.png" alt="image-20221027165140474" style="zoom:33%;" />

### 领域统计

以待计算的栅格像元为中心，向外拓展一定区域（窗口），基于这些拓展栅格进行统计或栅格运算得到新像元的值

在ArcgisPro中使用【领域分析】-【**焦点统计**】来对栅格中的**每一个像元**赋予其**领域范围**内所有数据的**统计信息**

### 分类区统计

以一个栅格作为分区类（要素区域数据），对另一个栅格数据集（赋值栅格）进行数值统计分析。要素区域数据中像元值相等的为一个分区无论是否近邻，对赋值栅格中落入该区域的所有像元进行统计，得出的值赋予该区域的所有像元。

<img src="https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027185425017.png" alt="image-20221027185425017" style="zoom:33%;" />

应用：统计不同土地利用下的坡度信息

重分类略

## 栅格运算

### 算数运算

简单的栅格像元值加减乘除

### 布尔运算

使用布尔运算符对栅格数据（0或非0数据）进行运算，结果为真结果像元赋值为1，为假像元赋值为0.布尔运算优先级大于关系运算（>、<、>=等 ）

| &（和）   | 对应栅格值均为非0返回真                                  |
| --------- | -------------------------------------------------------- |
| \| （或） | 对应栅格值存在非0值返回真                                |
| ! (异或)  | 两个或以上的栅格存在逻辑互逆返回真（一个为0，另一个非0） |
| ^ (非)    | 栅格值为0返回真                                          |

### 关系运算

以比较关系为基础进行计算，根据关系的真假返回1或0。

### 函数计算

根据自带的数学函数对栅格进行计算

### 条件分析

`Con`运算:`<结果栅格> = Con(<输入的栅格>, <表达式为真赋予的值>, <表达式为假赋予的值>, "<表达式>")`

例如： `OutRas = Con(InRas1, 40, 30, "Value >= 2")`

`OutRas = Con(InRas1, 40, 0, "Value >= 2")` 可简化成 `OutRas = Con("InRas1" >= 2, 40)`

选取`Pick`:位置栅格数据的值用于确定要从输入栅格列表中的**哪一个栅格**获取输出像元值。

![image-20221027193743735](https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027193743735.png)

`"SINGLE_BAND"`表示单波段运算,`InRas1`的各像元值若为合法的索引值（大于0的整数），则会以该索引从栅格列表中找到该栅格的值输出（索引从1开始），若索引非法则输出NoData



`SetNull`运算：“设为空函数”根据指定条件将所识别的像元位置设置为 NoData。如果条件评估为真，则返回 NoData；如果条件评估为假，则返回由另一个栅格指定的值。

![image-20221027192724021](https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027192724021.png)

### 逻辑运算

`Diff`：`Diff(InRas1, InRas2)`,返回**InRas1中**与InRas2不同的值，若相同返回0，若二者存在NoData返回NoData



`InList`运算：逐个像元来确定第一个输入栅格中的哪些值同样包含在该组的其他输入栅格中。找不到值赋予NoData

![image-20221027192558763](https://markdown-img-1311240910.cos.ap-nanjing.myqcloud.com/image-20221027192558763.png)

`IsNull`:`IsNull(InRas1)`如果输入值为 NoData，则返回 1，否则返回 0。

`Over`:`Over(InRas1, InRas2)`:当第一个输入中的像元值不是 0 时，输出值将是第一个输入中相应的像元值。如果该像元值为 0，输出值将是第二个输入栅格对应像元的值。

`Test`:`Test(InRas1,"Value >= 2")`:如果该表达式评估结果为真，则输出像元值为 1。如果该表达式评估结果为假，则输出像元值为 0。
